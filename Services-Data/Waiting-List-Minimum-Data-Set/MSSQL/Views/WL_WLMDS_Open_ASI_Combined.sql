CREATE VIEW [Final].[WL_WLMDS_Open_ASI_Combined]
AS
(
	SELECT 'Open_Pathways' AS 'Table_Source',
		   [OP].[derRowId],
		   [DATE_AND_TIME_DATA_SET_CREATED],
		   [Waiting_List_Type],
		   [Pseudo NHS_NUMBER],
		   [LOCAL_PATIENT_IDENTIFIER], -- [LOCAL_PATIENT_IDENTIFIER],
		   [PERSON_STATED_GENDER_CODE],
		   [ETHNIC_CATEGORY],
		   [REFERRAL_REQUEST_RECEIVED_DATE],
		   [Referral_Identifier], --[Referral_Identifier] varchar(20),
		   [PATIENT_PATHWAY_IDENTIFIER],
		   [SOURCE_OF_REFERRAL],
		   [OP].[ORGANISATION_IDENTIFIER_CODE_OF_PROVIDER],
		   [OP].[ORGANISATION_SITE_IDENTIFIER_OF_TREATMENT],
		   [MAIN_SPECIALTY_CODE],
		   [ACTIVITY_TREATMENT_FUNCTION_CODE],
		   [CONSULTANT_CODE],
		   [REFERRAL_TO_TREATMENT_PERIOD_START_DATE],
		   [Outpatient_Future_Appointment_Date],
		   [Due_Date],
		   [Outpatient_Appointment_Date],
		   [Date_Last_Attended],
		   [Last_DNA_Date],
		   [Cancellation_Date],
		   [OUTCOME_OF_ATTENDANCE_CODE],
		   [Local_Outcome_Of_Attendance],
		   [TCI_Date],
		   [REFERRAL_TO_TREATMENT_PERIOD_STATUS],
		   [Local_RTT_Status_Code],
		   [DECISION_TO_ADMIT_DATE],
		   [Proposed_Procedure_OPCS_Code],
		   [OP].[ORGANISATION_IDENTIFIER_CODE_OF_COMMISSIONER],
		   [OP].[ADMISSION_METHOD_CODE_HOSPITAL_PROVIDER_SPELL],
		   [PRIORITY_TYPE_CODE],
		   [REFERRAL_TO_TREATMENT_PERIOD_END_DATE],
		   [Procedure_Priority_Code],
		   [Outpatient_Priority_Code],
		   [Date_Of_Last_Priority_Review],
		   [Last_PAS_Validation_Performed_By],
		   [Last_PAS_Validation_Date],
		   [Last_PAS_Validation_Comments],
		   [Inclusion_On_Cancer_PTL],
		   [derSubmissionId],
		   [derProviderCode],
		   [derWeekEnding],
		   [derFileName],
		   [derSubmissionDateTimeFromDLP],
		   [Week_Ending_Date],
		   [OP].[ORGANISATION_CODE_PATIENT_PATHWAY_IDENTIFIER_ISSUER],
		   [Current_Pathway_Period_Start_Date],
		   [Diagnostic_Priority_Code],
		   OP.Der_Age_at_Referral_To_Treatment_Period_Start_Date,
           OP.Der_Age_WeekEndingDate,
           OP.Der_AgeBand_at_Referral_To_Treatment_Period_Start_Date,
           OP.Der_AgeBand_WeekEndingDate, 
		   [INTENDED_MANAGEMENT_CODE],
		   [Capacity_Status],
		   [Requires_Alternative_Capacity],
		   [ASA_PHYSICAL_STATUS_CLASSIFICATION_SYSTEM_CODE],
		   [Outcome_Of_Patient_Contact],
		   [Transfer_Status],
		   [Mutual_Aid_Accepting_Provider],
		   [FIRST_ACTIVITY_DATE],
		   [FIRST_ACTIVITY_TYPE],
		   [DECISION_TO_TREAT_DATE],
	       [TCI_Date_Provided],
	       [Preliminary_Screening_And_Risk_Assessment_Date],
	       [Action_Following_Preliminary_Screening_And_Risk_Assessment]
	FROM Final.WL_WLMDS_OpenPathways AS OP

	UNION ALL

	SELECT 'ASI/RAS/CAS_Pathways' AS 'Table_Source',
		   [ACR].[derRowId],
		   [DATE_AND_TIME_DATA_SET_CREATED],
		   'ORTT' AS [Waiting_List_Type],
		   [Pseudo NHS_NUMBER],
		   NULL AS [LOCAL_PATIENT_IDENTIFIER],  -- NULL as [LOCAL_PATIENT_IDENTIFIER],
		   NULL AS [PERSON_STATED_GENDER_CODE],
		   NULL AS [ETHNIC_CATEGORY],
		   [REFERRAL_REQUEST_RECEIVED_DATE],
		   [Referral_Identifier], -- NULL as [Pseudo Referral_Identifier],
		   NULL AS [PATIENT_PATHWAY_IDENTIFIER],
		   NULL AS [SOURCE_OF_REFERRAL_FOR_OUT-PATIENTS],
		   [ACR].[ORGANISATION_IDENTIFIER_CODE_OF_PROVIDER],
		   NULL AS [ORGANISATION_SITE_IDENTIFIER_(OF_TREATMENT)],
		   NULL AS [MAIN_SPECIALTY_CODE],
		   [ACTIVITY_TREATMENT_FUNCTION_CODE],
		   NULL AS [CONSULTANT_CODE],
		   ACR.REFERRAL_REQUEST_RECEIVED_DATE AS [REFERRAL_TO_TREATMENT_PERIOD_START_DATE],
		   NULL AS [Outpatient_Future_Appointment_Date],
		   NULL AS [Due_Date],
		   NULL AS [Outpatient_Appointment_Date],
		   NULL AS [Date_Last_Attended],
		   NULL AS [Last_DNA_Date],
		   NULL AS [Cancellation_Date],
		   NULL AS [OUTCOME_OF_ATTENDANCE_CODE],
		   NULL AS [Local_Outcome_Of_Attendance],
		   NULL AS [TCI_Date],
		   NULL AS [REFERRAL_TO_TREATMENT_PERIOD_STATUS],
		   NULL AS [Local_RTT_Status_Code],
		   NULL AS [DECISION_TO_ADMIT_DATE],
		   NULL AS [Proposed_Procedure_OPCS_Code],
		   ACR.ORGANISATION_IDENTIFIER_CODE_OF_COMMISSIONER,
		   NULL AS [ADMISSION_METHOD_CODE_(HOSPITAL_PROVIDER_SPELL)],
		   NULL AS [PRIORITY_TYPE_CODE],
		   NULL AS [REFERRAL_TO_TREATMENT_PERIOD_END_DATE],
		   NULL AS [Procedure_Priority_Code],
		   NULL AS [Outpatient_Priority_Code],
		   NULL AS [Date_Of_Last_Priority_Review],
		   NULL AS [Last_PAS_Validation_Performed_By],
		   ACR.Last_PAS_Validation_Date,
		   NULL AS [Last_PAS_Validation_Comments],
		   NULL AS [Inclusion_On_Cancer_PTL],
		   [derSubmissionId],
		   [derProviderCode],
		   [derWeekEnding],
		   [derFileName],
		   [derSubmissionDateTimeFromDLP],
		   [Week_Ending_Date],
		   NULL AS [ORGANISATION_CODE_(PATIENT_PATHWAY_IDENTIFIER_ISSUER)],
		   NULL AS [Current_Pathway_Period_Start_Date],
		   NULL AS [Diagnostic_Priority_Code],
		   NULL AS Der_Age_at_Referral_To_Treatment_Period_Start_Date,
           NULL AS Der_Age_WeekEndingDate,
           NULL AS Der_AgeBand_at_Referral_To_Treatment_Period_Start_Date,
           NULL AS Der_AgeBand_WeekEndingDate,
		   NULL AS [INTENDED_MANAGEMENT_CODE],
		   NULL AS [Capacity_Status],
		   NULL AS [Requires_Alternative_Capacity],
		   NULL AS [ASA_PHYSICAL_STATUS_CLASSIFICATION_SYSTEM_CODE],
		   NULL AS [Outcome_Of_Patient_Contact],
		   NULL AS [Transfer_Status],
		   NULL AS [Mutual_Aid_Accepting_Provider],
		   NULL AS [FIRST_ACTIVITY_DATE],
		   NULL AS [FIRST_ACTIVITY_TYPE],
		   NULL AS [DECISION_TO_TREAT_DATE],
	       NULL AS [TCI_Date_Provided],
	       NULL AS [Preliminary_Screening_And_Risk_Assessment_Date],
	       NULL AS [Action_Following_Preliminary_Screening_And_Risk_Assessment]
	FROM Final.WL_WLMDS_AsiCasRas AS ACR
);
